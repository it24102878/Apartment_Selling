<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PropertyHub - Rent Properties</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');

        :root {
            /* Light Mode Variables */
            --bg-primary-light: #F9FAFB;
            --bg-secondary-light: #FFFFFF;
            --text-primary-light: #111827;
            --text-secondary-light: #6B7280;
            --primary-light: #4F46E5;
            --secondary-light: #06B6D4;
            --accent-light: #F59E0B;
            --shadow-light: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --border-light: rgba(79, 70, 229, 0.1);
            --success-light: #22C55E;
            --error-light: #EF4444;

            /* Dark Mode Variables */
            --bg-primary-dark: #1F2937;
            --bg-secondary-dark: #374151;
            --text-primary-dark: #F3F4F6;
            --text-secondary-dark: #D1D5DB;
            --primary-dark: #818CF8;
            --secondary-dark: #22D3EE;
            --accent-dark: #FBBF24;
            --shadow-dark: 0 4px 6px -1px rgba(0, 0, 0, 0.3), 0 2px 4px -1px rgba(0, 0, 0, 0.2);
            --border-dark: rgba(129, 140, 248, 0.2);
            --success-dark: #4ADE80;
            --error-dark: #F87171;

            /* Default to Light Mode */
            --bg-primary: var(--bg-primary-light);
            --bg-secondary: var(--bg-secondary-light);
            --text-primary: var(--text-primary-light);
            --text-secondary: var(--text-secondary-light);
            --primary: var(--primary-light);
            --secondary: var(--secondary-light);
            --accent: var(--accent-light);
            --shadow: var(--shadow-light);
            --border: var(--border-light);
            --success: var(--success-light);
            --error: var(--error-light);
            --transition: all 0.3s ease;
        }

        [data-theme="dark"] {
            --bg-primary: var(--bg-primary-dark);
            --bg-secondary: var(--bg-secondary-dark);
            --text-primary: var(--text-primary-dark);
            --text-secondary: var(--text-secondary-dark);
            --primary: var(--primary-dark);
            --secondary: var(--secondary-dark);
            --accent: var(--accent-dark);
            --shadow: var(--shadow-dark);
            --border: var(--border-dark);
            --success: var(--success-dark);
            --error: var(--error-dark);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            transition: var(--transition);
        }

        .container {
            width: 100%;
            max-width: 1280px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header Styles */
        header {
            background-color: var(--bg-secondary);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 0;
        }

        .logo {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary);
            text-decoration: none;
            display: flex;
            align-items: center;
            transition: var(--transition);
        }

        .logo:hover {
            transform: scale(1.05);
        }

        .logo i {
            margin-right: 12px;
        }

        .nav-menu {
            display: flex;
            list-style: none;
        }

        .nav-menu li {
            margin: 0 20px;
        }

        .nav-menu a {
            text-decoration: none;
            color: var(--text-primary);
            font-weight: 500;
            transition: var(--transition);
            padding: 10px 15px;
            border-radius: 8px;
        }

        .nav-menu a:hover, .nav-menu a.active {
            color: var(--primary);
            background-color: rgba(var(--primary-rgb, 79, 70, 229), 0.05);
        }

        .auth-buttons {
            display: flex;
            align-items: center;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            border: none;
            font-size: 16px;
        }

        .btn-login {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            margin-right: 12px;
        }

        .btn-signup {
            background-color: var(--primary);
            color: var(--bg-secondary);
            border: 1px solid var(--primary);
        }

        .btn-login:hover {
            background-color: rgba(var(--primary-rgb, 79, 70, 229), 0.05);
            transform: translateY(-2px);
        }

        .btn-signup:hover {
            background-color: var(--primary-dark, #4338CA);
            transform: translateY(-2px);
        }

        .theme-toggle {
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 20px;
            cursor: pointer;
            padding: 10px;
            border-radius: 50%;
            transition: var(--transition);
        }

        .theme-toggle:hover {
            background-color: rgba(var(--primary-rgb, 79, 70, 229), 0.05);
            transform: scale(1.1);
        }

        /* User Dropdown Styles */
        .user-dropdown {
            position: relative;
            display: none;
        }

        .user-trigger {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            padding: 10px 18px;
            border-radius: 30px;
            transition: var(--transition);
        }

        .user-trigger:hover {
            background-color: rgba(var(--primary-rgb, 79, 70, 229), 0.05);
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-secondary);
            font-weight: 600;
            font-size: 16px;
        }

        .user-name {
            color: var(--primary);
            font-weight: 500;
            font-size: 16px;
        }

        .dropdown-arrow {
            color: var(--primary);
            font-size: 14px;
            transition: transform 0.3s;
        }

        .user-dropdown.active .dropdown-arrow {
            transform: rotate(180deg);
        }

        .user-dropdown-menu {
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-secondary);
            border-radius: 16px;
            box-shadow: var(--shadow);
            border: 1px solid var(--border);
            min-width: 280px;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(-10px);
            transition: var(--transition);
            margin-top: 8px;
        }

        .user-dropdown-menu.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .dropdown-header {
            padding: 24px;
            display: flex;
            align-items: center;
            gap: 14px;
        }

        .user-avatar-large {
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-secondary);
            font-weight: 600;
            font-size: 20px;
        }

        .user-details {
            display: flex;
            flex-direction: column;
        }

        .user-name-large {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 18px;
        }

        .user-email {
            color: var(--text-secondary);
            font-size: 14px;
            margin-top: 4px;
        }

        .dropdown-divider {
            height: 1px;
            background: var(--border);
            margin: 0 12px;
        }

        .dropdown-menu-items {
            padding: 12px 0;
            list-style: none;
            margin: 0;
        }

        .dropdown-menu-items a {
            display: flex;
            align-items: center;
            gap: 14px;
            padding: 14px 24px;
            color: var(--text-primary);
            text-decoration: none;
            transition: var(--transition);
        }

        .dropdown-menu-items a:hover {
            background-color: rgba(var(--primary-rgb, 79, 70, 229), 0.05);
            color: var(--primary);
        }

        .dropdown-menu-items i {
            width: 20px;
            text-align: center;
            color: var(--text-secondary);
        }

        .dropdown-menu-items a:hover i {
            color: var(--primary);
        }

        .dropdown-footer {
            padding: 12px 24px 24px;
        }

        .btn-logout-dropdown {
            width: 100%;
            padding: 12px;
            background: rgba(var(--primary-rgb, 79, 70, 229), 0.05);
            color: var(--error);
            border: 1px solid var(--border);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-logout-dropdown:hover {
            background: rgba(var(--error-rgb, 239, 68, 68), 0.05);
            border-color: var(--error);
        }

        /* Hero Section */
        .hero {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--bg-secondary);
            padding: 80px 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hero::before {
            content: '';
            position: absolute;
            bottom: -50px;
            left: 0;
            width: 100%;
            height: 100px;
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%23F9FAFB' fill-opacity='1' d='M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,128C960,160,1056,224,1152,245.3C1248,267,1344,245,1392,234.7L1440,224L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
            background-size: cover;
            transition: var(--transition);
        }

        [data-theme="dark"] .hero::before {
            background: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1440 320'%3E%3Cpath fill='%231F2937' fill-opacity='1' d='M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,112C672,96,768,96,864,128C960,160,1056,224,1152,245.3C1248,267,1344,245,1392,234.7L1440,224L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z'%3E%3C/path%3E%3C/svg%3E");
        }

        .hero h1 {
            font-size: 3em;
            margin-bottom: 24px;
            font-weight: 700;
        }

        .hero p {
            font-size: 1.2em;
            max-width: 700px;
            margin: 0 auto 30px;
            opacity: 0.95;
        }

        /* Main Content Grid */
        .grid {
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 30px;
            margin: 40px auto;
        }

        .card {
            background: var(--bg-secondary);
            border-radius: 16px;
            box-shadow: var(--shadow);
            padding: 24px;
            transition: var(--transition);
        }

        .card h2 {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 18px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        /* Filters Section */
        .filters {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: 16px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .filter-section {
            margin-bottom: 20px;
        }

        .filter-section h3 {
            font-size: 0.9rem;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .filter-row {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-section.half {
            flex: 1;
        }

        .filter-section.third {
            flex: 1;
        }

        .filter-input {
            position: relative;
        }

        .filter-input input {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: var(--transition);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        .filter-input input:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb, 79, 70, 229), 0.1);
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            cursor: pointer;
        }

        .select-wrapper {
            position: relative;
        }

        .select-wrapper select {
            appearance: none;
            width: 100%;
            padding: 12px 35px 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            background-color: var(--bg-secondary);
            font-size: 0.9rem;
            cursor: pointer;
            transition: var(--transition);
            color: var(--text-primary);
        }

        .select-wrapper select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb, 79, 70, 229), 0.1);
        }

        .select-wrapper::after {
            content: '\f107';
            font-family: 'Font Awesome 5 Free';
            font-weight: 900;
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-secondary);
            pointer-events: none;
        }

        .price-range-container {
            padding: 5px 10px;
        }

        .price-slider {
            position: relative;
            height: 5px;
            margin: 20px 0;
        }

        .slider-track {
            position: absolute;
            width: 100%;
            height: 5px;
            background: var(--border);
            border-radius: 3px;
        }

        .slider {
            position: absolute;
            width: 100%;
            height: 5px;
            background: none;
            pointer-events: none;
            -webkit-appearance: none;
            appearance: none;
            outline: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            pointer-events: auto;
            border: 2px solid var(--bg-secondary);
            box-shadow: 0 0 3px rgba(0,0,0,0.3);
        }

        .slider::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: var(--accent);
            border-radius: 50%;
            cursor: pointer;
            pointer-events: auto;
            border: 2px solid var(--bg-secondary);
            box-shadow: 0 0 3px rgba(0,0,0,0.3);
        }

        #price-min {
            z-index: 2;
        }

        #price-max {
            z-index: 1;
        }

        .price-values {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin-top: 5px;
        }

        input[type="date"] {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: var(--transition);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        input[type="date"]:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb, 79, 70, 229), 0.1);
        }

        .amenities-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }

        .checkbox-container {
            display: flex;
            align-items: center;
            position: relative;
            padding-left: 30px;
            cursor: pointer;
            font-size: 0.9rem;
            user-select: none;
            margin: 5px 0;
            color: var(--text-secondary);
        }

        .checkbox-container input {
            position: absolute;
            opacity: 0;
            cursor: pointer;
            height: 0;
            width: 0;
        }

        .checkmark {
            position: absolute;
            left: 0;
            height: 20px;
            width: 20px;
            background-color: var(--bg-secondary);
            border: 2px solid var(--border);
            border-radius: 5px;
            transition: var(--transition);
        }

        .checkbox-container:hover input ~ .checkmark {
            border-color: var(--primary);
        }

        .checkbox-container input:checked ~ .checkmark {
            background-color: var(--accent);
            border-color: var(--accent);
        }

        .checkmark:after {
            content: "";
            position: absolute;
            display: none;
        }

        .checkbox-container input:checked ~ .checkmark:after {
            display: block;
        }

        .checkbox-container .checkmark:after {
            left: 6px;
            top: 2px;
            width: 5px;
            height: 10px;
            border: solid var(--bg-secondary);
            border-width: 0 2px 2px 0;
            transform: rotate(45deg);
        }

        .filter-actions {
            display: flex;
            align-items: flex-end;
            gap: 10px;
            margin-left: auto;
        }

        .btn-reset {
            background: transparent;
            color: var(--text-secondary);
            border: 1px solid var(--border);
            padding: 12px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
        }

        .btn-reset:hover {
            background: var(--bg-primary);
        }

        .btn-search {
            background: var(--accent);
            color: var(--bg-secondary);
            padding: 12px 25px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            transition: var(--transition);
        }

        .btn-search:hover {
            background: var(--accent-dark, #D97706);
            transform: translateY(-2px);
        }

        /* Properties Grid */
        .properties-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 30px;
            margin: 40px 0;
        }

        .property-card {
            background: var(--bg-secondary);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
        }

        .property-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }

        .property-image {
            position: relative;
            height: 250px;
            background: linear-gradient(45deg, var(--primary), var(--secondary));
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--bg-secondary);
            font-size: 24px;
            font-weight: 600;
        }

        .property-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            position: absolute;
            top: 0;
            left: 0;
        }

        .property-image-placeholder {
            position: relative;
            z-index: 1;
            opacity: 0.8;
            font-size: 18px;
            text-align: center;
            padding: 20px;
        }

        .property-image::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.1);
            transition: var(--transition);
        }

        .property-card:hover .property-image::after {
            background: rgba(0, 0, 0, 0.2);
        }

        .property-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--primary);
            color: var(--bg-secondary);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            z-index: 2;
        }

        .property-content {
            padding: 24px;
        }

        .property-price {
            color: var(--primary);
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 12px;
        }

        .property-address {
            color: var(--text-secondary);
            margin-bottom: 18px;
            font-size: 15px;
        }

        .property-features {
            display: flex;
            justify-content: space-between;
            margin-bottom: 18px;
        }

        .property-features span {
            display: flex;
            align-items: center;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .property-features i {
            margin-right: 6px;
            color: var(--secondary);
        }

        .property-type-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            font-size: 0.9rem;
        }

        .property-type-badge {
            background: var(--bg-primary);
            color: var(--text-primary);
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .property-date {
            color: var(--text-secondary);
            font-size: 0.8rem;
        }

        .property-description {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .property-actions {
            display: flex;
            justify-content: space-between;
            border-top: 1px solid var(--border);
            padding-top: 18px;
        }

        .btn-book {
            background-color: var(--primary);
            color: var(--bg-secondary);
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            transition: var(--transition);
            text-decoration: none;
            font-size: 14px;
            border: none;
            font-weight: 500;
        }

        .btn-book:hover {
            background-color: var(--primary-dark, #4338CA);
            transform: translateY(-2px);
        }

        .btn-save {
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            padding: 10px 18px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            transition: var(--transition);
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .btn-save:hover {
            background-color: rgba(var(--primary-rgb, 79, 70, 229), 0.05);
            transform: translateY(-2px);
        }

        .btn-save.saved {
            background: var(--success);
            color: var(--bg-secondary);
            border-color: var(--success);
        }

        /* Enhanced Pay Now Button Styles */
        .pay-now-btn {
            background: linear-gradient(135deg, var(--success) 0%, #16A34A 100%);
            color: white !important;
            padding: 15px 30px;
            border-radius: 12px;
            font-size: 18px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            border: none;
            cursor: pointer;
            width: 100%;
        }

        .pay-now-btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        .pay-now-btn:hover {
            background: linear-gradient(135deg, #16A34A 0%, #15803D 100%) !important;
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }

        .pay-now-btn:hover:before {
            left: 100%;
        }

        .pay-now-btn:active {
            transform: translateY(0);
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.3);
        }

        .pay-now-btn i {
            font-size: 20px;
        }

        /* Footer */
        footer {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: var(--bg-secondary);
            padding: 60px 0 24px;
            margin-top: 60px;
            position: relative;
            overflow: hidden;
        }

        .footer-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 36px;
            margin-bottom: 36px;
        }

        .footer-column h3 {
            font-size: 20px;
            margin-bottom: 24px;
            font-weight: 600;
        }

        .footer-column ul {
            list-style: none;
        }

        .footer-column ul li {
            margin-bottom: 12px;
        }

        .footer-column a {
            color: var(--text-secondary);
            text-decoration: none;
            transition: var(--transition);
        }

        .footer-column a:hover {
            color: var(--bg-secondary);
        }

        .copyright {
            text-align: center;
            padding-top: 24px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            color: var(--text-secondary);
            font-size: 14px;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            box-shadow: var(--shadow);
            width: 90%;
            max-width: 500px;
            padding: 30px;
            position: relative;
            max-height: 80vh;
            overflow-y: auto;
        }

        .close-modal {
            position: absolute;
            top: 24px;
            right: 24px;
            background: none;
            border: none;
            font-size: 28px;
            cursor: pointer;
            color: var(--text-secondary);
            transition: var(--transition);
        }

        .close-modal:hover {
            color: var(--text-primary);
            transform: rotate(90deg);
        }

        .modal h2 {
            margin-bottom: 15px;
            color: var(--text-primary);
            font-size: 1.5rem;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 4px;
            font-weight: 600;
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        .form-group input,
        .form-group select {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 0.9rem;
            transition: var(--transition);
            background-color: var(--bg-secondary);
            color: var(--text-primary);
        }

        .form-group input:focus,
        .form-group select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(var(--primary-rgb, 79, 70, 229), 0.1);
        }

        .form-group select {
            appearance: none;
            background: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="12" height="12" viewBox="0 0 24 24"><path fill="%237f8c8d" d="M7 10l5 5 5-5z"/></svg>') no-repeat right 8px center;
            background-size: 12px;
        }

        .payment-fields-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .payment-fields-group .form-group {
            flex: 1;
            min-width: 150px;
        }

        .price-calculation {
            background: var(--bg-primary);
            padding: 12px;
            border-radius: 8px;
            margin: 12px 0;
            border: 1px solid var(--border);
        }

        .price-row {
            display: flex;
            justify-content: space-between;
            margin: 6px 0;
            font-size: 0.9rem;
        }

        .price-total {
            font-weight: bold;
            border-top: 1px solid var(--border);
            padding-top: 8px;
            margin-top: 8px;
            font-size: 1rem;
        }

        .btn-primary {
            width: 100%;
            padding: 12px;
            background: var(--primary);
            color: var(--bg-secondary);
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .btn-primary:hover {
            background-color: var(--primary-dark, #4338CA);
            transform: translateY(-2px);
        }

        .btn-secondary {
            width: 100%;
            padding: 12px;
            background: transparent;
            color: var(--primary);
            border: 1px solid var(--primary);
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
            margin-top: 10px;
        }

        .btn-secondary:hover {
            background-color: rgba(var(--primary-rgb, 79, 70, 229), 0.05);
            transform: translateY(-2px);
        }

        /* Toast Notification */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            box-shadow: var(--shadow);
            z-index: 1001;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
            max-width: 350px;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        .toast-content {
            display: flex;
            align-items: center;
            padding: 15px 20px;
            gap: 12px;
        }

        .toast-icon {
            color: var(--success);
            font-size: 18px;
        }

        .toast-message {
            color: var(--text-primary);
            font-weight: 500;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .grid {
                grid-template-columns: 1fr;
            }

            .filter-row {
                flex-direction: column;
            }

            .properties-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                padding: 20px;
                max-height: 85vh;
            }

            .payment-fields-group {
                flex-direction: column;
            }

            .hero h1 {
                font-size: 2.5rem;
            }
        }

        /* Animation for Messages */
        .animate-fadeIn {
            animation: fadeIn 0.3s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
    <script src="profile-avatar.js"></script>
</head>
<body>
<!-- Header -->
<header>
    <div class="container">
        <div class="header-top">
            <a href="index.html" class="logo">
                <i class="fas fa-home"></i>
                PropertyHub
            </a>

            <ul class="nav-menu">
                <li><a href="index.html">Home</a></li>
                <li><a href="buy.html" onclick="checkAuth('buy')">Buy</a></li>
                <li><a href="Rent.html" class="active">Rent</a></li>
                <li><a href="apartment.html" onclick="checkAuth('sell')">Sell</a></li>
                <li><a href="reviews.html">Reviews</a></li>
                <li><a href="dashboard.html" onclick="checkAuth('dashboard')">Dashboard</a></li>
            </ul>

            <!-- User Account Dropdown -->
            <div class="user-dropdown" id="userDropdown">
                <div class="user-trigger" id="userTrigger">
                    <div class="user-avatar" id="userAvatar">JD</div>
                    <span class="user-name" id="userName">John Doe</span>
                    <i class="fas fa-chevron-down dropdown-arrow"></i>
                </div>
                <div class="user-dropdown-menu" id="userDropdownMenu">
                    <div class="dropdown-header">
                        <div class="user-avatar-large" id="userAvatarLarge">JD</div>
                        <div class="user-details">
                            <div class="user-name-large" id="userNameLarge">John Doe</div>
                            <div class="user-email" id="userEmail">john.doe@example.com</div>
                        </div>
                    </div>
                    <div class="dropdown-divider"></div>
                    <ul class="dropdown-menu-items">
                        <li><a href="profile.html"><i class="fas fa-user"></i> Profile</a></li>
                        <li><a href="reviews.html"><i class="fas fa-star"></i> Reviews</a></li>
                        <li><a href="dashboard.html" onclick="checkAuth('dashboard')"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                        <li><a href="apartment.html" onclick="checkAuth('sell')"><i class="fas fa-home"></i> Sell</a></li>
                    </ul>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-footer">
                        <button class="btn-logout-dropdown" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i> Logout
                        </button>
                    </div>
                </div>
            </div>

            <!-- Auth Buttons (shown when not logged in) -->
            <div class="auth-buttons" id="authButtons">
                <button class="btn btn-login" id="loginBtn">Login</button>
                <button class="btn btn-signup" id="signupBtn">Sign Up</button>
            </div>

            <!-- Theme Toggle -->
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i>
            </button>
        </div>
    </div>
</header>

<!-- Hero Section -->
<section class="hero">
    <div class="container">
        <h1>Find Your Perfect Rental</h1>
        <p>Discover apartments, houses, and condos for rent in your desired location</p>
    </div>
</section>

<!-- Main Content -->
<div class="container">
    <!-- Filters Section -->
    <div class="filters">
        <div class="filter-row">
            <div class="filter-section half">
                <h3>Location</h3>
                <div class="filter-input">
                    <input type="text" id="location" placeholder="Enter city, neighborhood, or zip code">
                    <i class="fas fa-search search-icon"></i>
                </div>
            </div>
            <div class="filter-section half">
                <h3>Property Type</h3>
                <div class="select-wrapper">
                    <select id="propertyType">
                        <option value="">Any Type</option>
                        <option value="apartment">Apartment</option>
                        <option value="house">House</option>
                        <option value="condo">Condo</option>
                        <option value="townhouse">Townhouse</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="filter-row">
            <div class="filter-section third">
                <h3>Price Range</h3>
                <div class="price-range-container">
                    <div class="price-slider">
                        <div class="slider-track"></div>
                        <input type="range" min="500" max="5000" value="1000" class="slider" id="price-min">
                        <input type="range" min="500" max="5000" value="3000" class="slider" id="price-max">
                    </div>
                    <div class="price-values">
                        <span id="min-value">$1,000</span>
                        <span id="max-value">$3,000</span>
                    </div>
                </div>
            </div>
            <div class="filter-section third">
                <h3>Bedrooms</h3>
                <div class="select-wrapper">
                    <select id="bedrooms">
                        <option value="">Any</option>
                        <option value="1">1+</option>
                        <option value="2">2+</option>
                        <option value="3">3+</option>
                        <option value="4">4+</option>
                    </select>
                </div>
            </div>
            <div class="filter-section third">
                <h3>Bathrooms</h3>
                <div class="select-wrapper">
                    <select id="bathrooms">
                        <option value="">Any</option>
                        <option value="1">1+</option>
                        <option value="2">2+</option>
                        <option value="3">3+</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="filter-row">
            <div class="filter-section half">
                <h3>Move-in Date</h3>
                <input type="date" id="moveInDate">
            </div>
            <div class="filter-section half">
                <h3>Amenities</h3>
                <div class="amenities-container">
                    <label class="checkbox-container">Pet Friendly
                        <input type="checkbox" id="petFriendly">
                        <span class="checkmark"></span>
                    </label>
                    <label class="checkbox-container">Parking
                        <input type="checkbox" id="parking">
                        <span class="checkmark"></span>
                    </label>
                    <label class="checkbox-container">Laundry
                        <input type="checkbox" id="laundry">
                        <span class="checkmark"></span>
                    </label>
                    <label class="checkbox-container">Furnished
                        <input type="checkbox" id="furnished">
                        <span class="checkmark"></span>
                    </label>
                </div>
            </div>
        </div>

        <div class="filter-row">
            <div class="filter-actions">
                <button class="btn-reset" id="resetFilters">Reset</button>
                <button class="btn-search" id="searchBtn">Search Properties</button>
            </div>
        </div>
    </div>

    <!-- Properties Grid -->
    <div class="properties-grid" id="propertiesGrid">
        <!-- Property cards will be generated here -->
    </div>
</div>

<!-- Footer -->
<footer>
    <div class="container">
        <div class="footer-content">
            <div class="footer-column">
                <h3>PropertyHub</h3>
                <p>Find your dream home with our extensive property listings and expert guidance.</p>
            </div>
            <div class="footer-column">
                <h3>Quick Links</h3>
                <ul>
                    <li><a href="index.html">Home</a></li>
                    <li><a href="buy.html">Buy</a></li>
                    <li><a href="rent.html">Rent</a></li>
                    <li><a href="apartment.html">Sell</a></li>
                </ul>
            </div>
            <div class="footer-column">
                <h3>Contact Us</h3>
                <ul>
                    <li><i class="fas fa-map-marker-alt"></i> 123 Property St, City, State</li>
                    <li><i class="fas fa-phone"></i> (123) 456-7890</li>
                    <li><i class="fas fa-envelope"></i> info@propertyhub.com</li>
                </ul>
            </div>
        </div>
        <div class="copyright">
            <p>&copy; 2023 PropertyHub. All rights reserved.</p>
        </div>
    </div>
</footer>

<!-- Booking Modal -->
<div class="modal" id="bookingModal">
    <div class="modal-content">
        <button class="close-modal" id="closeBookingModal">&times;</button>
        <h2>Book Property</h2>
        <form id="bookingForm">
            <div class="form-group">
                <label for="fullName">Full Name</label>
                <input type="text" id="fullName" required>
            </div>
            <div class="form-group">
                <label for="email">Email</label>
                <input type="email" id="email" required>
            </div>
            <div class="form-group">
                <label for="phone">Phone Number</label>
                <input type="tel" id="phone" required>
            </div>
            <div class="form-group">
                <label for="moveInDateModal">Move-in Date</label>
                <input type="date" id="moveInDateModal" required>
            </div>
            <div class="form-group">
                <label for="leaseLength">Lease Length (months)</label>
                <select id="leaseLength" required>
                    <option value="6">6 months</option>
                    <option value="12" selected>12 months</option>
                    <option value="18">18 months</option>
                    <option value="24">24 months</option>
                </select>
            </div>
            <div class="form-group">
                <label>Payment Information</label>
                <div class="payment-fields-group">
                    <div class="form-group">
                        <input type="text" id="cardNumber" placeholder="Card Number" required>
                    </div>
                    <div class="form-group">
                        <input type="text" id="expiryDate" placeholder="MM/YY" required>
                    </div>
                    <div class="form-group">
                        <input type="text" id="cvv" placeholder="CVV" required>
                    </div>
                </div>
            </div>
            <div class="price-calculation">
                <div class="price-row">
                    <span>Monthly Rent:</span>
                    <span id="monthlyRent">$2,500</span>
                </div>
                <div class="price-row">
                    <span>Security Deposit:</span>
                    <span id="securityDeposit">$2,500</span>
                </div>
                <div class="price-row">
                    <span>Application Fee:</span>
                    <span id="applicationFee">$50</span>
                </div>
                <div class="price-row price-total">
                    <span>Total Due Now:</span>
                    <span id="totalDue">$5,050</span>
                </div>
            </div>
            <button type="submit" class="btn-primary pay-now-btn">
                <i class="fas fa-credit-card"></i>
                Pay Now
            </button>
            <button type="button" class="btn-secondary" id="saveForLater">Save for Later</button>
        </form>
    </div>
</div>

<!-- Toast Notification -->
<div class="toast" id="toast">
    <div class="toast-content">
        <i class="fas fa-check-circle toast-icon"></i>
        <span class="toast-message" id="toastMessage">Property saved successfully!</span>
    </div>
</div>

<script>
    // API Configuration
    const API_BASE = 'http://localhost:8080/api';
    let currentUserID = null;

    // Initialize user session
    function initializeUserSession() {
        const sessionUser = JSON.parse(localStorage.getItem('sessionUser') || '{}');
        if (sessionUser && sessionUser.userID) {
            currentUserID = sessionUser.userID;
            console.log('Current user ID:', currentUserID);
        }
    }

    // Initialize session on page load
    initializeUserSession();

    // Theme Toggle Functionality
    const themeToggle = document.getElementById('themeToggle');
    const themeIcon = themeToggle.querySelector('i');

    // Check for saved theme preference or default to light
    const currentTheme = localStorage.getItem('theme') || 'light';
    if (currentTheme === 'dark') {
        document.documentElement.setAttribute('data-theme', 'dark');
        themeIcon.classList.remove('fa-moon');
        themeIcon.classList.add('fa-sun');
    }

    themeToggle.addEventListener('click', () => {
        let theme = 'light';
        if (document.documentElement.getAttribute('data-theme') === 'dark') {
            document.documentElement.removeAttribute('data-theme');
            themeIcon.classList.remove('fa-sun');
            themeIcon.classList.add('fa-moon');
        } else {
            document.documentElement.setAttribute('data-theme', 'dark');
            themeIcon.classList.remove('fa-moon');
            themeIcon.classList.add('fa-sun');
            theme = 'dark';
        }
        localStorage.setItem('theme', theme);
    });

    // User Dropdown Functionality
    const userDropdown = document.getElementById('userDropdown');
    const userTrigger = document.getElementById('userTrigger');
    const userDropdownMenu = document.getElementById('userDropdownMenu');
    const authButtons = document.getElementById('authButtons');

    // Update user dropdown with current user info
    function updateUserDropdown(user) {
        userDropdown.style.display = 'block';
        authButtons.style.display = 'none';

        document.getElementById('userName').textContent = user.name;
        document.getElementById('userNameLarge').textContent = user.name;
        document.getElementById('userEmail').textContent = user.email;

        // Update avatars with profile pictures
        updateUserAvatars(user);
    }

    function updateUserAvatars(user) {
        const savedPicture = getUserProfilePicture(user.userID);
        const userAvatar = document.getElementById('userAvatar');
        const userAvatarLarge = document.getElementById('userAvatarLarge');

        if (savedPicture) {
            // Replace with image elements
            userAvatar.innerHTML = `<img src="${savedPicture}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" alt="Profile">`;
            userAvatarLarge.innerHTML = `<img src="${savedPicture}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;" alt="Profile">`;
        } else {
            // Show initials
            const initials = getUserInitials(user.name);
            userAvatar.textContent = initials;
            userAvatarLarge.textContent = initials;
        }
    }

    function resetUserDropdown() {
        userDropdown.style.display = 'none';
        authButtons.style.display = 'flex';
    }

    // Authentication check for navigation
    function checkAuth(page) {
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser') || 'null');
        if (currentUser) {
            // User is authenticated, redirect to the page
            switch(page) {
                case 'buy':
                    window.location.href = 'buy.html';
                    break;
                case 'sell':
                    window.location.href = 'apartment.html';
                    break;
                case 'dashboard':
                    window.location.href = 'dashboard.html';
                    break;
            }
        } else {
            // User not authenticated, redirect to login page
            window.location.href = 'index.html';
        }
    }

    // Check for current user from session storage
    try {
        const currentUser = JSON.parse(sessionStorage.getItem('currentUser'));
        if (currentUser) {
            updateUserDropdown(currentUser);
        } else {
            resetUserDropdown();
        }
    } catch(e) {
        console.log('No user session found');
        resetUserDropdown();
    }

    userTrigger.addEventListener('click', () => {
        userDropdown.classList.toggle('active');
        userDropdownMenu.classList.toggle('show');
    });

    // Close dropdown when clicking outside
    document.addEventListener('click', (e) => {
        if (!userDropdown.contains(e.target)) {
            userDropdown.classList.remove('active');
            userDropdownMenu.classList.remove('show');
        }
    });

    // Logout functionality
    document.getElementById('logoutBtn').addEventListener('click', () => {
        // In a real app, this would redirect to logout endpoint
        window.location.href = 'index.html';
    });

    // Login/Signup buttons
    document.getElementById('loginBtn').addEventListener('click', () => {
        // In a real app, this would open a login modal or redirect
        alert('Login functionality would be implemented here');
    });

    document.getElementById('signupBtn').addEventListener('click', () => {
        // In a real app, this would open a signup modal or redirect
        alert('Signup functionality would be implemented here');
    });

    // Price Range Slider
    const priceMin = document.getElementById('price-min');
    const priceMax = document.getElementById('price-max');
    const minValue = document.getElementById('min-value');
    const maxValue = document.getElementById('max-value');

    function updatePriceValues() {
        const min = parseInt(priceMin.value);
        const max = parseInt(priceMax.value);

        minValue.textContent = `$${min.toLocaleString()}`;
        maxValue.textContent = `$${max.toLocaleString()}`;

        // Ensure min doesn't exceed max
        if (min > max) {
            priceMin.value = max;
            minValue.textContent = `$${max.toLocaleString()}`;
        }
    }

    priceMin.addEventListener('input', updatePriceValues);
    priceMax.addEventListener('input', updatePriceValues);

    // Default images for different property types
    const defaultImages = {
        apartment: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=400&h=250&fit=crop&crop=center",
        house: "https://images.unsplash.com/photo-1570129477492-45c003edd2be?w=400&h=250&fit=crop&crop=center",
        condo: "https://images.unsplash.com/photo-1545167622-3a6ac756afa4?w=400&h=250&fit=crop&crop=center",
        townhouse: "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=400&h=250&fit=crop&crop=center",
        studio: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=400&h=250&fit=crop&crop=center"
    };

    // Sample Property Data
    const properties = [
        {
            id: 1,
            title: "Modern Downtown Apartment",
            price: 2500,
            address: "123 Main St, Downtown, City",
            bedrooms: 2,
            bathrooms: 2,
            sqft: 1200,
            type: "apartment",
            available: "2023-07-15",
            description: "Beautiful modern apartment in the heart of downtown with stunning city views.",
            amenities: ["Pet Friendly", "Parking", "Laundry"],
            image: "https://images.unsplash.com/photo-1545324418-cc1a3fa10c00?w=400&h=250&fit=crop&crop=center"
        },
        {
            id: 2,
            title: "Cozy Suburban House",
            price: 1800,
            address: "456 Oak Ave, Suburbia, City",
            bedrooms: 3,
            bathrooms: 2,
            sqft: 1600,
            type: "house",
            available: "2023-08-01",
            description: "Spacious family home in a quiet neighborhood with a large backyard.",
            amenities: ["Parking", "Laundry", "Furnished"],
            image: "https://images.unsplash.com/photo-1570129477492-45c003edd2be?w=400&h=250&fit=crop&crop=center"
        },
        {
            id: 3,
            title: "Luxury Waterfront Condo",
            price: 3500,
            address: "789 Harbor Dr, Waterfront, City",
            bedrooms: 2,
            bathrooms: 2.5,
            sqft: 1500,
            type: "condo",
            available: "2023-07-20",
            description: "Stunning waterfront condo with panoramic views and premium amenities.",
            amenities: ["Pet Friendly", "Parking", "Laundry", "Furnished"],
            image: "https://images.unsplash.com/photo-1545167622-3a6ac756afa4?w=400&h=250&fit=crop&crop=center"
        },
        {
            id: 4,
            title: "Charming Townhouse",
            price: 2200,
            address: "321 Elm St, Historic District, City",
            bedrooms: 3,
            bathrooms: 2.5,
            sqft: 1800,
            type: "townhouse",
            available: "2023-08-10",
            description: "Beautifully restored townhouse with original hardwood floors and modern updates.",
            amenities: ["Parking", "Laundry"],
            image: "https://images.unsplash.com/photo-1564013799919-ab600027ffc6?w=400&h=250&fit=crop&crop=center"
        },
        {
            id: 5,
            title: "Studio in Arts District",
            price: 1200,
            address: "654 Gallery Ln, Arts District, City",
            bedrooms: 1,
            bathrooms: 1,
            sqft: 700,
            type: "apartment",
            available: "2023-07-25",
            description: "Bright studio apartment in the vibrant arts district, perfect for creatives.",
            amenities: ["Pet Friendly", "Laundry"],
            image: "https://images.unsplash.com/photo-1522708323590-d24dbb6b0267?w=400&h=250&fit=crop&crop=center"
        },
        {
            id: 6,
            title: "Spacious Family Home",
            price: 2800,
            address: "987 Maple Rd, Familyville, City",
            bedrooms: 4,
            bathrooms: 3,
            sqft: 2200,
            type: "house",
            available: "2023-08-15",
            description: "Large family home with updated kitchen, multiple living areas, and a spacious yard.",
            amenities: ["Parking", "Laundry", "Furnished"],
            image: "https://images.unsplash.com/photo-1448630360428-65456885c650?w=400&h=250&fit=crop&crop=center"
        }
    ];

    // Generate Property Cards
    const propertiesGrid = document.getElementById('propertiesGrid');

    function generatePropertyCards(propertiesToShow) {
        propertiesGrid.innerHTML = '';

        propertiesToShow.forEach(property => {
            const card = document.createElement('div');
            card.className = 'property-card animate-fadeIn';

            card.innerHTML = `
                <div class="property-image">
                    <img src="${property.image || defaultImages[property.type] || defaultImages.apartment}"
                         alt="${property.title}"
                         onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                    <div class="property-image-placeholder" style="display: none;">
                        <i class="fas fa-home" style="font-size: 48px; margin-bottom: 10px;"></i>
                        <div>${property.title}</div>
                    </div>
                    <div class="property-badge">For Rent</div>
                </div>
                <div class="property-content">
                    <div class="property-price">$${property.price.toLocaleString()}/month</div>
                    <div class="property-address">${property.address}</div>
                    <div class="property-features">
                        <span><i class="fas fa-bed"></i> ${property.bedrooms} Bed</span>
                        <span><i class="fas fa-bath"></i> ${property.bathrooms} Bath</span>
                        <span><i class="fas fa-ruler-combined"></i> ${property.sqft} sqft</span>
                    </div>
                    <div class="property-type-info">
                        <span class="property-type-badge">${property.type.charAt(0).toUpperCase() + property.type.slice(1)}</span>
                        <span class="property-date">Available: ${new Date(property.available).toLocaleDateString()}</span>
                    </div>
                    <div class="property-description">${property.description}</div>
                    <div class="property-actions">
                        <button class="btn-book" data-id="${property.id}">Book Now</button>
                        <button class="btn-save" data-id="${property.id}">
                            <i class="far fa-heart"></i> Save
                        </button>
                    </div>
                </div>
            `;

            propertiesGrid.appendChild(card);
        });

        // Add event listeners to book buttons
        document.querySelectorAll('.btn-book').forEach(button => {
            button.addEventListener('click', (e) => {
                const propertyId = e.target.getAttribute('data-id');
                openBookingModal(propertyId);
            });
        });

        // Add event listeners to save buttons
        document.querySelectorAll('.btn-save').forEach(button => {
            button.addEventListener('click', (e) => {
                const propertyId = e.target.closest('.btn-save').getAttribute('data-id');
                toggleSaveProperty(propertyId, e.target.closest('.btn-save'));
            });
        });
    }

    // Initialize with all properties
    generatePropertyCards(properties);

    // Filter Properties
    document.getElementById('searchBtn').addEventListener('click', filterProperties);
    document.getElementById('resetFilters').addEventListener('click', resetFilters);

    function filterProperties() {
        const location = document.getElementById('location').value.toLowerCase();
        const propertyType = document.getElementById('propertyType').value;
        const minPrice = parseInt(priceMin.value);
        const maxPrice = parseInt(priceMax.value);
        const bedrooms = document.getElementById('bedrooms').value;
        const bathrooms = document.getElementById('bathrooms').value;
        const moveInDate = document.getElementById('moveInDate').value;
        const petFriendly = document.getElementById('petFriendly').checked;
        const parking = document.getElementById('parking').checked;
        const laundry = document.getElementById('laundry').checked;
        const furnished = document.getElementById('furnished').checked;

        const filteredProperties = properties.filter(property => {
            // Location filter
            if (location && !property.address.toLowerCase().includes(location) &&
                !property.title.toLowerCase().includes(location)) {
                return false;
            }

            // Property type filter
            if (propertyType && property.type !== propertyType) {
                return false;
            }

            // Price filter
            if (property.price < minPrice || property.price > maxPrice) {
                return false;
            }

            // Bedrooms filter
            if (bedrooms && property.bedrooms < parseInt(bedrooms)) {
                return false;
            }

            // Bathrooms filter
            if (bathrooms && property.bathrooms < parseInt(bathrooms)) {
                return false;
            }

            // Move-in date filter
            if (moveInDate && property.available < moveInDate) {
                return false;
            }

            // Amenities filters
            if (petFriendly && !property.amenities.includes("Pet Friendly")) {
                return false;
            }

            if (parking && !property.amenities.includes("Parking")) {
                return false;
            }

            if (laundry && !property.amenities.includes("Laundry")) {
                return false;
            }

            if (furnished && !property.amenities.includes("Furnished")) {
                return false;
            }

            return true;
        });

        generatePropertyCards(filteredProperties);

        if (filteredProperties.length === 0) {
            propertiesGrid.innerHTML = `
                <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                    <h3>No properties match your search criteria</h3>
                    <p>Try adjusting your filters to see more results.</p>
                </div>
            `;
        }
    }

    function resetFilters() {
        document.getElementById('location').value = '';
        document.getElementById('propertyType').value = '';
        priceMin.value = 1000;
        priceMax.value = 3000;
        updatePriceValues();
        document.getElementById('bedrooms').value = '';
        document.getElementById('bathrooms').value = '';
        document.getElementById('moveInDate').value = '';
        document.getElementById('petFriendly').checked = false;
        document.getElementById('parking').checked = false;
        document.getElementById('laundry').checked = false;
        document.getElementById('furnished').checked = false;

        generatePropertyCards(properties);
    }

    // Booking Modal Functionality
    const bookingModal = document.getElementById('bookingModal');
    const closeBookingModal = document.getElementById('closeBookingModal');
    const bookingForm = document.getElementById('bookingForm');
    const saveForLater = document.getElementById('saveForLater');

    function openBookingModal(propertyId) {
        const property = properties.find(p => p.id == propertyId);
        if (property) {
            document.getElementById('monthlyRent').textContent = `$${property.price.toLocaleString()}`;
            document.getElementById('securityDeposit').textContent = `$${property.price.toLocaleString()}`;
            document.getElementById('totalDue').textContent = `$${(property.price * 2 + 50).toLocaleString()}`;
            bookingModal.style.display = 'flex';
        }
    }

    closeBookingModal.addEventListener('click', () => {
        bookingModal.style.display = 'none';
    });

    window.addEventListener('click', (e) => {
        if (e.target === bookingModal) {
            bookingModal.style.display = 'none';
        }
    });

    bookingForm.addEventListener('submit', (e) => {
        e.preventDefault();
        // In a real app, this would submit the booking form
        showToast('Booking request submitted successfully!');
        bookingModal.style.display = 'none';
    });

    saveForLater.addEventListener('click', () => {
        // In a real app, this would save the property to user's favorites
        showToast('Property saved for later!');
        bookingModal.style.display = 'none';
    });

    // Save Property Functionality
    async function toggleSaveProperty(propertyId, button) {
        if (!currentUserID) {
            alert('Please log in to save properties.');
            return;
        }

        const icon = button.querySelector('i');

        try {
            if (button.classList.contains('saved')) {
                // Unsave the property
                await unsaveProperty(propertyId);
                button.classList.remove('saved');
                icon.classList.remove('fas');
                icon.classList.add('far');
                showToast('Property removed from saved list');
            } else {
                // Save the property
                await saveProperty(propertyId);
                button.classList.add('saved');
                icon.classList.remove('far');
                icon.classList.add('fas');
                showToast('Property saved successfully!');
            }
        } catch (error) {
            console.error('Error toggling save state:', error);
            showToast('Failed to update property. Please try again.');
        }
    }

    // Save property function
    async function saveProperty(propertyId) {
        try {
            // Find the property in displayed properties
            const property = properties.find(p => p.id === propertyId);
            if (!property) {
                console.error('Property not found:', propertyId);
                throw new Error('Property not found');
            }

            // Prepare the data to save
            const saveData = {
                userID: currentUserID,
                propertyPrice: property.price.toString(),
                propertyAddress: property.location,
                propertyFeatures: `${property.bedrooms} bed, ${property.bathrooms} bath`,
                propertyData: {
                    apartmentID: property.id,
                    title: property.title,
                    type: property.type,
                    bedrooms: property.bedrooms,
                    bathrooms: property.bathrooms,
                    sqft: property.sqft,
                    amenities: property.amenities,
                    imageUrl: property.image,
                    createdAt: property.createdAt || new Date().toISOString()
                }
            };

            const response = await fetch(`${API_BASE}/saved-properties`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(saveData)
            });

            const result = await response.json();

            if (!result.success) {
                throw new Error(result.message || 'Failed to save property');
            }

            return result;

        } catch (error) {
            console.error('Error saving property:', error);
            throw error;
        }
    }

    // Unsave property function
    async function unsaveProperty(propertyId) {
        try {
            // Find the saved property ID by getting user's saved properties
            const response = await fetch(`${API_BASE}/user/saved-properties/${currentUserID}`);
            if (!response.ok) {
                throw new Error('Failed to fetch saved properties');
            }

            const savedProperties = await response.json();
            const savedProperty = savedProperties.find(sp => {
                // Check if the saved property data contains our property ID
                try {
                    const propertyData = JSON.parse(sp.propertyData || '{}');
                    return propertyData.apartmentID === propertyId || sp.apartmentID === propertyId;
                } catch (e) {
                    return sp.apartmentID === propertyId;
                }
            });

            if (!savedProperty) {
                throw new Error('Property not found in saved list');
            }

            // Delete the saved property
            const deleteResponse = await fetch(`${API_BASE}/saved-properties/${savedProperty.savedPropertyID}`, {
                method: 'DELETE'
            });

            const result = await deleteResponse.json();

            if (!result.success) {
                throw new Error(result.message || 'Failed to remove property');
            }

            return result;

        } catch (error) {
            console.error('Error removing saved property:', error);
            throw error;
        }
    }

    // Toast Notification Functionality
    const toast = document.getElementById('toast');
    const toastMessage = document.getElementById('toastMessage');

    function showToast(message) {
        toastMessage.textContent = message;
        toast.classList.add('show');

        setTimeout(() => {
            toast.classList.remove('show');
        }, 3000);
    }
</script>
</body>
</html>

